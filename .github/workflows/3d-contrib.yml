name: Generate 3D Contribution Graph

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å –ø–æ UTC
    - cron: "0 0 * * *"
  workflow_dispatch:
    # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑ –≤–∫–ª–∞–¥–∫–∏ Actions
  push:
    branches: [ main ]

jobs:
  generate-3d-contrib:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Generate 3D contribution graph
        uses: yoshi389111/github-profile-3d-contrib@0.7.1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          user_name: ${{ github.repository_owner }}
          theme: green-dual
      
      - name: Rename generated file
        run: |
          # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
          if [ -f "profile-3d-contrib.svg" ]; then
            mv profile-3d-contrib.svg profile-3d-contrib-green-dual.svg
            echo "‚úÖ File renamed to profile-3d-contrib-green-dual.svg"
          else
            echo "‚ö†Ô∏è File profile-3d-contrib.svg not found"
            ls -la
          fi
      
      - name: Commit and push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
          if git diff --staged --quiet; then
            echo "üì≠ No changes to commit"
          else
            git commit -m "ü§ñ Auto-update 3D contribution graph [$(date +%Y-%m-%d)]"
            git push
            echo "‚úÖ Changes committed and pushed"
          fi
